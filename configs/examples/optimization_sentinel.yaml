# ============================================================================
# Optuna Hyperparameter Optimization — Sentinel Temporal Models
# ============================================================================
# This config defines the search space for hyperparameter optimization
# of Sentinel-2 temporal models (UTAE++ and TSViT). Used alongside a
# base Sentinel training config.
#
# Usage:
#   python -m src.pipeline.sentinel_optimization \
#       -c configs/examples/sentinel_tsvit.yaml \
#       -o configs/examples/optimization_sentinel.yaml
# ============================================================================

optimization:
  study_name: sentinel-temporal-models
  n_trials: 20                           # More trials since search space is complex
  n_epochs: 10                           # Temporal models need more epochs to converge
  direction: maximize                    # Maximize mIoU

  # ---------------------------------------------------------------------------
  # Global Search Space
  # ---------------------------------------------------------------------------
  search_space:
    # Training hyperparameters
    - name: training.optimizer.learning_rate
      type: float
      low: 1.0e-5
      high: 1.0e-3
      log: true

    - name: training.optimizer.weight_decay
      type: float
      low: 1.0e-6
      high: 1.0e-3
      log: true

    # Model architecture selection (compare UTAE++ vs TSViT)
    - name: model.model_type
      type: categorical
      choices:
        - UTAE
        - TSVIT

    # Context window size: spatial extent of Sentinel-2 crop.
    # Larger = more spatial context but higher memory usage.
    - name: data.context_size
      type: categorical
      choices:
        - 10    # No extra context (baseline)
        - 20    # 2× context
        - 40    # 4× context

  # ---------------------------------------------------------------------------
  # Model-Specific Search Spaces
  # ---------------------------------------------------------------------------
  model_specific_search_space:
    # ---- UTAE++ architecture parameters ----
    utae:
      - name: model.model_config.encoder_widths
        type: categorical
        choices:
          - [64, 64, 64, 128]
          - [32, 32, 64, 128]
          - [64, 128, 128, 256]

      - name: model.model_config.decoder_widths
        type: categorical
        choices:
          - [32, 32, 64, 128]
          - [32, 64, 64, 128]
          - [64, 64, 128, 128]

      - name: model.model_config.n_head
        type: categorical
        choices: [4, 8, 16]

      - name: model.model_config.d_model
        type: categorical
        choices: [128, 256, 512]

      - name: model.model_config.d_k
        type: categorical
        choices: [4, 8, 16]

    # ---- TSViT architecture parameters ----
    tsvit:
      - name: model.model_config.dim
        type: categorical
        choices: [64, 128, 256]

      - name: model.model_config.num_heads
        type: categorical
        choices: [4, 8]

      - name: model.model_config.temporal_depth
        type: int
        low: 2
        high: 6

      - name: model.model_config.spatial_depth
        type: int
        low: 2
        high: 6

      - name: model.model_config.dropout
        type: float
        low: 0.0
        high: 0.3

      - name: model.model_config.emb_dropout
        type: float
        low: 0.0
        high: 0.2
